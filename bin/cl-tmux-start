#!/bin/zsh

set -ex

# echo Adding regular ssh keys...
# ls -1 ~/.ssh/keys/agent-* |grep -v '\.pub$' |xargs ssh-add

nested_prefix=C-b

tmux new-session -d -s meta -n system
tmux send-keys -R -t meta "TMUX= tmux new-session -s system -c $HOME" C-m C-l
tmux new-window -d -t meta -n code "TMUX= tmux new-session -s code -c $HOME/Work"
tmux new-window -d -t meta -n dbs "TMUX= tmux new-session -s dbs -c $HOME/Docker/postgres"
tmux new-window -d -t meta -n chat "TMUX= tmux new-session -s chat -c $HOME"

sleep 2

tmux set-option -t meta status-position top

tmux set-option -t chat prefix $nested_prefix
tmux set-option -t chat status-left-style fg=magenta,bg=brightwhite,bold
tmux set-option -t chat status-style bg=magenta,fg=brightwhite
tmux set-option -t chat set-titles-string '#S:#I ⫽ #W #{session_alerts}'
tmux set-option -t code prefix $nested_prefix
tmux set-option -t code status-left-style fg=cyan,bg=brightwhite,bold
tmux set-option -t code status-style bg=cyan,fg=brightwhite
tmux set-option -t code set-titles-string '#S:#I ⫽ #W #{session_alerts}'
tmux set-option -t dbs prefix $nested_prefix
tmux set-option -t dbs status-left-style fg=yellow,bg=brightwhite
tmux set-option -t dbs status-style bg=yellow,fg=brightwhite
tmux set-option -t dbs set-titles-string '#S:#I ⫽ #W #{session_alerts}'
tmux set-option -t system prefix $nested_prefix
tmux set-option -t system status-left-style fg=blue,bg=brightwhite,bold
tmux set-option -t system status-style bg=blue,fg=brightwhite
tmux set-option -t system set-titles-string '#S:#I ⫽ #W #{session_alerts}'

tmux new-window -d -t system -n ' htop' 'htop'
tmux new-window -d -t system -n ' dstat' 'dstat --all --noupdate 60'
tmux send-keys -R -t chat weechat C-m C-l

tmux bind-key $nested_prefix last-window

# exec tmux attach-session -t meta
